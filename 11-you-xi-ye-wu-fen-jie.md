# 1.1 游戏业务分解
## 1.1.1游戏简介

这是一个3D游戏，玩家打开客户端后会进入游戏地图。

+ 玩家可以通过鼠标键盘操作游戏人物进行移动。
+ 多个玩家同时在线时，彼此可以互相看到对方的位置和动作。
+ 玩家可以在聊天框输入聊天内容并发送给当前游戏的所有玩家

## 1.1.2游戏结构

这是一个简单的网络游戏，由客户端和服务器两部分组成

![](/assets/结构图.png)

多个客户端通过tcp连接到服务器并将自身的动作和操作发送给服务器，服务器端收到客户端发来的动作后进行一定处理和计算在通过tcp发送给某些客户端。

> 这是一个比较典型的cs架构

## 1.1.3职责分解

### 客户端职责（接受玩家输入，呈现游戏效果）

+ 程序运行后连接服务器
+ 玩家移动人物时，将玩家的移动信息发给服务器
+ 玩家发送聊天时，将聊天内容发给服务器
+ 接收服务器传来的其他玩家信息并呈现给玩家（玩家之间彼此能看到）
+ 接收服务器传来的聊天信息并呈现给玩家

### 服务器职责（接收客户端数据，发送数据给客户端）

+ 新客户端连接后，向其发送ID和名称
+ 新客户端连接后，向其发送**周围**玩家的位置
+ 新客户端连接后，向**周围**玩家发送其位置
+ 收到客户端的移动信息后，向**周围**玩家发送其新位置
+ 收到客户端的移动信息后，向其发送**周围新**玩家位置
+ 收到客户端的聊天信息后，向**所有**玩家发送聊天内容
+ 客户端断开时，向**周围**玩家发送其断开的消息

## 1.1.4 消息定义

每一条服务器和客户端之前的消息都应该满足以下格式

> |消息内容的长度（4个字节，低字节在前）|消息ID（4个字节，低字节在前）|消息内容|

详细定义如下

消息ID|消息内容|发送方向|客户端处理|服务器处理
-|-|-|-|-
1|玩家ID和玩家姓名|S->C|记录自己ID和姓名|无
2|聊天内容|C->S|无|广播给所有玩家
3|新位置|C->S|无|处理玩家位置更新后的信息同步
200|玩家ID，聊天内容/初始位置/动作（预留）/新位置|S->C|根据子类型不通而不同|无
201|玩家ID和玩家姓名|S->C|把该ID的玩家从画面中拿掉|无
202|周围玩家们的位置|S->C|在画面中显示周围的玩家|无

> 以上定义的消息以及其处理方式已经在客户端实现，本项目要实现的是**服务器端的相关处理**

## 1.1.5 服务器需求

1. 接收客户端连接，处理客户端断开
2. 按照上表处理客户端传来的各类消息
3. 按照上表向客户端发送各类消息

> 因为服务器要处理多个客户端的连接或数据，所有需要服务器能够处理多种**并发**请求。

### 并发方案
1. 基于连接使用多进程多线程
2. IO多路复用
3. 使用开源的并发框架



